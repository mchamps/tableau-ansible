<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2c5282;
            border-bottom: 2px solid #4299e1;
            padding-bottom: 10px;
        }
        h2 {
            color: #2d3748;
            margin-top: 30px;
            border-left: 4px solid #4299e1;
            padding-left: 10px;
        }
        .success {
            color: #276749;
            background-color: #c6f6d5;
            padding: 10px;
            border-radius: 4px;
        }
        .info-box {
            background-color: #ebf8ff;
            border: 1px solid #90cdf4;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .results-box {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .folder-path {
            font-family: 'Courier New', monospace;
            background-color: #edf2f7;
            padding: 2px 6px;
            border-radius: 3px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            text-align: left;
        }
        th {
            background-color: #4299e1;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f7fafc;
        }
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            font-size: 12px;
            color: #718096;
        }
    </style>
</head>
<body>
    <h1>Tableau Backup Report</h1>

    <div class="info-box">
        <strong>Host:</strong> {{ ansible_hostname }}<br>
        <strong>Timestamp:</strong> {{ ansible_date_time.iso8601 }}<br>
        <strong>Status:</strong> <span class="success">Completed</span>
    </div>

{% if tableau_backup_results is defined %}
    <h2>Backup Operations</h2>

    <h3>Server Settings Export</h3>
    <div class="results-box">{{ tableau_backup_results.settings_export | default('Not executed') }}</div>

    <h3>Maintenance Ziplogs</h3>
    <div class="results-box">{{ tableau_backup_results.ziplogs | default('Not executed') }}</div>

    <h3>Maintenance Cleanup</h3>
    <div class="results-box">{{ tableau_backup_results.cleanup | default('Not executed') }}</div>

    <h3>Backup</h3>
    <div class="results-box">{{ tableau_backup_results.backup | default('Not executed') }}</div>
{% endif %}

{% if tableau_cleanup_results is defined %}
    <h2>Cleanup Operations</h2>

    <h3>Backup Files Cleanup</h3>
    <div class="results-box">{{ tableau_cleanup_results.backup_cleanup | default('Not executed') }}</div>

    <h3>Log Files Cleanup</h3>
    <div class="results-box">{{ tableau_cleanup_results.log_cleanup | default('Not executed') }}</div>

    <h3>Backup Folder Contents</h3>
    <p>Path: <span class="folder-path">{{ backup_folder_path | default('N/A') }}</span></p>
    <div class="results-box">
{% for line in tableau_cleanup_results.backup_folder_contents | default(['No files found']) %}
{{ line }}
{% endfor %}
    </div>

    <h3>Log Folder Contents</h3>
    <p>Path: <span class="folder-path">{{ log_folder_path | default('N/A') }}</span></p>
    <div class="results-box">
{% for line in tableau_cleanup_results.log_folder_contents | default(['No files found']) %}
{{ line }}
{% endfor %}
    </div>
{% endif %}

    <div class="footer">
        <p>This is an automated message from Ansible Tableau Backup automation.</p>
        <p>Generated by: tableau-ansible</p>
    </div>
</body>
</html>
